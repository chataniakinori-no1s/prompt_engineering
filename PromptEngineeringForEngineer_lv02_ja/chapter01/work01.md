---
seq: 3
title: 実践課題
slug: chapter01/work01
description: Difyのローカル環境構築を通じて、AIアプリケーションプラットフォームの基本を理解する
type: work
difficulty: 2
displayLanguage: ja
duration: 20
---

# Difyをローカル環境に構築しよう 

あなたはGrowthTechの社員食堂で昼食を食べていると、管理部の塚本さんが話しかけてきました。
「社内規定とかマニュアルがあちこちに散らばってて、社員からの同じような質問に何度も答えてたら自分の業務に手が回らなくて...GeminiみたいなAIが窓口として社員の質問に答えてくれるチャットボットになったりしませんか？」

さて、皆さん。この身近な課題、もしこれまで学んできたプロンプトの知識だけで解決するとしたら、どうしますか？
おそらく、就業規則のPDFをコピーしてGeminiに貼り付け、「この内容から質問に答えて」と指示する方法を考えるかもしれませんね。
しかし、その方法では、分厚いマニュアルすべてを一度に扱えなかったり、毎回の会話で社員が同じ文書を貼り付ける必要があったりと、実用的ではありません。

そこで登場するのが、**Dify**というAIエージェント開発プラットフォームです。
Difyを使うと社内文書をAIに学習させ、誰もが簡単に使えるチャットボットをノーコード／ローコードで構築し、公開も可能です。

##　なぜDifyなのか？
AIエージェント開発プラットフォーム自体は他にもいくつか公開されていますが、以下の点でDifyが優れています。
☆ クラウド版／コミュニティ版で利用環境を選べる
☆ コミュニティが活発で更新頻度が高い（新機能・修正への対応）
☆ 日本国内における企業内活用実績も多い
☆ 今あるPCではじめられる
☆ 様々な外部システム（SlackやGoogle workspaceなど）と直接連携可能
☆ チャットボットからエージェントまで、ノーコードの開発領域が広い
☆ 基本的なRAGも簡単に構築できる
☆ モジュール化（フローをDSLファイル化）して再利用できる
☆ フローを外部システムからAPIで呼び出せして活用できる

この第6章では、コミュニティ版Difyをローカル環境に構築し、AIの力を活用した社内FAQボットの基盤を作成します。

## 1. 環境構築の準備

### Windows編
1. **システム要件のチェック**
使用しているPCがDifyを動かせる環境か確認しましょう。
- CPU: 2コア以上
- RAM: 4GB以上
- OS：64ビット版のWindows10、11　Home、Pro、Enterprise
　　 　Docker Desktopは基本的に64ビット環境専用となるため。

設定>システム>バージョン情報で確認できます。

2.Difyを動かすための環境として、GitとDockerを準備しましょう。

**Gitのインストール**
Git公式サイトからインストーラーをダウンロードします。
[Download for Windows](https://git-scm.com/downloads/win)

画像
ダウンロードしたインストーラーを実行します。

画像
インストーラーを実行（デフォルト設定でOKです）
ライセンスの確認をします

画像
ライセンスの確認
インストール先の選択をします　(デフォルト)

画像
インストールするものを選択します　(デフォルト)

画像
スタートメニューを作成するフォールダーを選択　(デフォルト)

画像
エディターの選択
今回エディターは使用しませんが
一般的に使用されている「Visual Studio Code」を選択しました

画像
新規リポジトリで作成される初期ブランチの名前を決める
Override the default branch name for new repositoriesを選択
「main」というブランチ名を推奨します

画像
環境設定の設定をします

画像
SSH実行に利用するものを選択します（デフォルト）

画像
GitでHTTPS通信時に利用する
SSL/TLSライブラリを選択します（デフォルト）

画像
テキストファイルの改行コードの設定をします（デフォルト）

画像
Git Bashを動かすエミュレーターの選択（デフォルト）

画像
git pullコマンド時の振る舞いの設定（デフォルト）

画像
資格情報のヘルパーの選択（デフォルト）

画像
その他の設定（デフォルト）

画像
この画面まで来たらインストール終了です
「Finish」ボタンをクリックして、画面を閉じてください。

画像
Gitのインストールができている確認
検索バーから「コマンド プロンプト」を起動します。

画像
コマンドプロンプトが開いたら以下のコマンドを入力します。

git -v

copy
インストールが正常にできていれば、Gitのバージョンが表示されます。

画像
Gitのインストール方法は以上となります！

3. **Docker Desktopのインストール**
⚠️ Docker Desktopのインストール後、PCの再起動が必要です。

公式サイトからインストーラーをダウンロード
[Docker Desktop install](https://docs.docker.com/desktop/setup/install/windows-install/)

画像
ダウンロードしたインストーラーを実行します。

画像
インストーラーを実行すると以下の画面が表示されます。
「OK」ボタンをクリックすると自動的にインストールが始まります。
WSLが入っていない場合は、一緒にインストールしてくれます。
時間がかかると思いますが、完了画面へ進むまでお待ちください。

画像
「Close and restart」をクリックし、PCを再起動します。

画像
PCの再起動が終わったら、Docker Desktopを起動します。

画像
メールアドレス入力の画面ですが、メアドの入力をしなくても利用可能なので、右上の「Skip」ボタンをクリックします。

画像
アンケートも「Skip」します。

画像
以下のような画面に進めたらDocker Desktopのインストールが完了です！

4. **DifyをDocker Desktopへ導入**
手順は頻繁に変わる場合があるため日本語ドキュメントもご確認ください。

GitからDifyのソースコードを取得
エクスプローラーを開きCドライブに「tool」という空のフォルダーを作成します。

画像
toolフォルダーをクリックし、Shiftキー＋右クリックし
「PowerShellウィンドウをここで開く」をクリックします。
以下のコマンドを実行し、GitからDifyのソースコードを取得します。

`git clone https://github.com/langgenius/dify.git`

全て100％になっていたらDifyのソースコードの取得が完了です！

画像
🌟 Difyの起動
PowerShellウィンドウで以下のコマンドを入力します。
・difyソースコードのdockerディレクトリに移動

`cd dify/docker`

・環境配置ファイルをコピー

`cp .env.example .env`

Docker コンテナを起動する

`docker compose up -d`

上記のコマンドを実行しDifyのローカル画面にアクセスしましょう！

>http://localhost/install

アカウントのセットアップとログインをします。

画像
画像
ログイン後以下の画面が表示されたらローカル環境の構築が完了です👏✨
http://localhost/

### Windows編
1. **システム要件のチェック**
使用しているPCがDifyを動かせる環境か確認しましょう。
- CPU: 2コア以上
- RAM: 4GB以上
- OS：64ビット版のWindows10、11　Home、Pro、Enterprise
　　 　Docker Desktopは基本的に64ビット環境専用となるため。

設定>システム>バージョン情報で確認できます。

2. **Docker Desktopのインストール**
   - [Docker公式サイト](https://www.docker.com/products/docker-desktop)からDocker Desktop for Windowsをダウンロードし、インストールします。
   - インストール後、Docker Desktopを起動します。

3. **WSL2の有効化**
   - コマンドプロンプトを管理者権限で開き、以下のコマンドを実行します：
     ```cmd
     wsl --install
     ```
   - 再起動を求められるので、PCを再起動します。

4. **Docker Composeファイルのダウンロード**
   - コマンドプロンプトを開き、作業用ディレクトリを作成して移動します：
     ```cmd
     mkdir dify
     cd dify
     ```
   - 以下のコマンドでDocker Composeファイルをダウンロードします：
     ```cmd
     curl -O https://raw.githubusercontent.com/langgenius/dify/main/docker/docker-compose.yaml
     ```

5. **Difyの起動**
   - 以下のコマンドでDifyを起動します：
     ```cmd
     docker-compose up -d
     ```
   - 初回起動時はイメージのダウンロードに時間がかかります。

6. **動作確認**
   - ブラウザで `http://localhost` にアクセスします。
   - 管理者アカウントを作成し、ログインできれば環境構築は成功です！

### Mac編
1. **システム要件のチェック**
使用しているPCがDifyを動かせる環境か確認しましょう。
-　2コア以上のCPU4
- 4GB以上のRAM

システム設定>一般>システムレポート から、コア数とメモリ数(RAM)の確認ができます。

1. **Docker Desktopのインストール**
   - [Docker公式サイト](https://www.docker.com/products/docker-desktop)からDocker Desktop for Macをダウンロードし、インストールします。
   - インストール後、Docker Desktopを起動します。

2. **Docker Composeファイルのダウンロード**
   - ターミナルを開き、作業用ディレクトリを作成して移動します：
     ```bash
     mkdir -p ~/dify
     cd ~/dify
     ```
   - 以下のコマンドでDocker Composeファイルをダウンロードします：
     ```bash
     curl -O https://raw.githubusercontent.com/langgenius/dify/main/docker/docker-compose.yaml
     ```

3. **Difyの起動**
   - 以下のコマンドでDifyを起動します：
     ```bash
     docker-compose up -d
     ```
   - 初回起動時はイメージのダウンロードに時間がかかります。

4. **動作確認**
   - ブラウザで `http://localhost` にアクセスします。
   - 管理者アカウントを作成し、ログインできれば環境構築は成功です！

## 2. Gemini APIキーの取得

DifyでGeminiモデルを使用するには、Google AI StudioからAPIキーを取得する必要があります。

1. **Google AI Studioにアクセス**
   - [Google AI Studio](https://aistudio.google.com/)にアクセスし、Googleアカウントでログインします。

2. **APIキーの取得**
   - 画面右上の設定アイコン（⚙️）をクリックし、「APIキー」を選択します。
   - 「APIキーを作成」をクリックし、表示されたAPIキーをコピーします。
   - **重要**: このAPIキーは他人に知られないように注意してください。

## 3. DifyでGeminiモデルを設定

1. **Difyにログイン**
   - 先ほど作成した管理者アカウントでDifyにログインします。

2. **モデルプロバイダーの設定**
   - 左側のメニューから「設定」→「モデルプロバイダー」を選択します。
   - 「Google」の「セットアップ」ボタンをクリックします。
   - 先ほどコピーしたAPIキーを貼り付け、「保存」をクリックします。

3. **モデルの確認**
   - 左側のメニューから「アプリケーション」→「新規アプリケーション」を選択します。
   - アプリケーション名を入力し、「チャットアプリ」を選択して「作成」をクリックします。
   - アプリケーションが作成されたら、左側の「モデル」をクリックします。
   - モデル一覧に「Gemini」が表示されていれば、設定は完了です。

## 4. 動作確認

1. **テストチャット**
   - アプリケーションの「チャット」タブを開き、メッセージを送信してみましょう。
   - Geminiモデルからの応答が返ってくれば、正常に動作しています。

2. **エラーが表示された場合**
   - APIキーが正しく設定されているか確認してください。
   - モデルが選択されているか確認してください。
   - エラーメッセージを確認し、必要に応じて設定を見直してください。

## 5. お疲れ様でした！

これでDifyのローカル環境構築とGeminiモデルの設定が完了しました。次のワークでは、この環境を使って実際に社内FAQボットを作成していきます。

## 補足: よくある質問

### Q. 起動時にエラーが発生する
- **Dockerが起動していない**: Docker Desktopが起動しているか確認してください。
- **ポートが既に使用中**: 別のアプリケーションが80ポートを使用している場合、Docker Composeファイルのポート番号を変更してください。

### Q. モデルが表示されない
- APIキーが正しく設定されているか確認してください。
- インターネット接続を確認してください。

### Q. レスポンスが遅い
- 初回起動時はモデルのダウンロードに時間がかかることがあります。
- ハードウェアリソース（CPU、メモリ）が十分か確認してください。
