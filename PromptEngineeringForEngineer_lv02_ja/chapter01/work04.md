---
seq: 6
title: 【小コラム】RAGの心臓部を探る：AIはどのようにして"賢く"検索しているのか？
slug: chapter01/column01
description: RAG技術の核心であるチャンク化と検索アルゴリズムの仕組みを解説
type: column
difficulty: 3
displayLanguage: ja
duration: 15
---

# RAGの心臓部を探る：AIはどのようにして"賢く"検索しているのか？

このワークでは、Difyの「知識取得」ノードを使って、驚くほど簡単にRAG（検索拡張生成）アプリケーションを構築できることを体験しました。しかし、ナレッジを作成する際に何気なくクリックした「前処理設定」や、裏側で動いている「検索」の仕組みには、実はRAGの性能を左右する重要な技術が詰まっています。

このコラムでは、ワークでは詳しく触れなかったRAGの2つの心臓部、**「チャンク化（文書の分割）」**と**「検索アルゴリズム」**について深掘りします。これらの仕組みを理解することで、なぜDifyがあのように賢く振る舞えるのかが分かり、将来的により精度の高いRAGアプリケーションを構築するためのヒントが得られるでしょう。

## チャンク化：文書をどう分割するかが重要

RAGの第一歩は、元の文書を「チャンク」と呼ばれる小さな断片に分割することです。このチャンク化の仕方が、AIの回答品質に大きく影響します。

### 単純なチャンク化の問題点

最も単純な方法は、文書を一定の文字数で区切る方法です。例えば、1000文字ごとに分割するといった具合です。しかし、この方法には以下のような問題があります：

1. 文の途中で切れてしまうと、文脈が失われる
2. 重要な情報がチャンクの境目で分断される可能性がある
3. 長い文書と短い文書でチャンクの質にばらつきが生じる

### より賢いチャンク化の手法

Difyを含む多くのRAGシステムでは、より高度なチャンク化の手法が採用されています：

- **意味的な区切りを考慮**: 段落や見出しの境界で分割する
- **オーバーラップを持たせる**: チャンク同士で一部重複を持たせ、文脈の連続性を保つ
- **階層的な分割**: 大見出し、中見出し、小見出しなどの階層構造を考慮して分割

## 検索アルゴリズム：関連性の高い情報を見つけ出す技術

RAGのもう一つの重要な要素が、ユーザーの質問に基づいて関連するチャンクを効率的に見つけ出す検索アルゴリズムです。

### ベクトル検索（セマンティック検索）

Difyの「高品質」モードで使用されているのが、このベクトル検索です。

1. **埋め込み（Embedding）**: テキストを数値のベクトルに変換
2. **類似度計算**: 質問のベクトルと文書のベクトルの類似度を計算
3. **ランキング**: 類似度が高い順に結果を返す

### ハイブリッド検索

Difyの「高品質」モードでは、以下の2つを組み合わせたハイブリッド検索が行われています：

* **ベクトル検索**で、質問の意図や文脈に合ったチャンクを大まかに見つけ出す。
* **全文検索**で、特定のキーワードや固有名詞が含まれるチャンクを正確に見つけ出す。

この2つのアプローチを組み合わせることで、意味の近さとキーワードの一致度を両方考慮した、非常に精度の高い検索が実現します。
