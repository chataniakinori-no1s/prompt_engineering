---
seq: 1
title: ワーク1: Difyをローカル環境に構築しよう
slug: chapter01/work01
description: Difyのローカル環境構築を通じて、AIアプリケーションプラットフォームの基本を理解する
type: work
difficulty: 2
displayLanguage: ja
duration: 20
---

# Difyをローカル環境に構築しよう 

管理部の塚本さんは、これまでたくさんのプロンプトを書いてきたあなたに以下の相談を投げかけてきました。
「社内規定とかマニュアルがあちこちに散らばってて、社員からの同じ質問に何度も答えるのが大変...Geminiがそのまま社員の質問に答えてくれるチャットボットになったりしないかな？」

さて、皆さん。この身近な課題、もしこれまで学んできたプロンプトの知識だけで解決するとしたら、どうしますか？
おそらく、就業規則のPDFをコピーしてGeminiに貼り付け、「この内容から質問に答えて」と指示する方法を考えるかもしれませんね。
しかし、その方法では、分厚いマニュアルすべてを一度に扱えなかったり、毎回の会話で同じ文書を貼り付ける必要があったりと、実用的ではありません。

そこで登場するのが、**Dify**というAIアプリケーションプラットフォームです。Difyを使うと、社内文書をAIに学習させ、誰もが簡単に使えるチャットボットとして公開できます。

このワークでは、Difyをローカル環境に構築し、AIの力を活用した社内FAQボットの基礎を作成します。

## 1. 環境構築の準備

まずは、Difyを動かすための環境を準備しましょう。DifyはDockerを使って簡単に構築できます。

### Windows編 🪟

1. **Docker Desktopのインストール**
   - [Docker公式サイト](https://www.docker.com/products/docker-desktop)からDocker Desktop for Windowsをダウンロードし、インストールします。
   - インストール後、Docker Desktopを起動します。

2. **WSL2の有効化**
   - PowerShellを管理者権限で開き、以下のコマンドを実行します：
     ```powershell
     wsl --install
     ```
   - 再起動を求められるので、PCを再起動します。

3. **Docker Composeファイルのダウンロード**
   - コマンドプロンプトを開き、作業用ディレクトリを作成して移動します：
     ```cmd
     mkdir dify
     cd dify
     ```
   - 以下のコマンドでDocker Composeファイルをダウンロードします：
     ```cmd
     curl -O https://raw.githubusercontent.com/langgenius/dify/main/docker/docker-compose.yaml
     ```

4. **Difyの起動**
   - 以下のコマンドでDifyを起動します：
     ```cmd
     docker-compose up -d
     ```
   - 初回起動時はイメージのダウンロードに時間がかかります。

5. **動作確認**
   - ブラウザで `http://localhost` にアクセスします。
   - 管理者アカウントを作成し、ログインできれば環境構築は成功です！

### Mac編 🍎

1. **Docker Desktopのインストール**
   - [Docker公式サイト](https://www.docker.com/products/docker-desktop)からDocker Desktop for Macをダウンロードし、インストールします。
   - インストール後、Docker Desktopを起動します。

2. **Docker Composeファイルのダウンロード**
   - ターミナルを開き、作業用ディレクトリを作成して移動します：
     ```bash
     mkdir -p ~/dify
     cd ~/dify
     ```
   - 以下のコマンドでDocker Composeファイルをダウンロードします：
     ```bash
     curl -O https://raw.githubusercontent.com/langgenius/dify/main/docker/docker-compose.yaml
     ```

3. **Difyの起動**
   - 以下のコマンドでDifyを起動します：
     ```bash
     docker-compose up -d
     ```
   - 初回起動時はイメージのダウンロードに時間がかかります。

4. **動作確認**
   - ブラウザで `http://localhost` にアクセスします。
   - 管理者アカウントを作成し、ログインできれば環境構築は成功です！

## 2. Gemini APIキーの取得

DifyでGeminiモデルを使用するには、Google AI StudioからAPIキーを取得する必要があります。

1. **Google AI Studioにアクセス**
   - [Google AI Studio](https://aistudio.google.com/)にアクセスし、Googleアカウントでログインします。

2. **APIキーの取得**
   - 画面右上の設定アイコン（⚙️）をクリックし、「APIキー」を選択します。
   - 「APIキーを作成」をクリックし、表示されたAPIキーをコピーします。
   - **重要**: このAPIキーは他人に知られないように注意してください。

## 3. DifyでGeminiモデルを設定

1. **Difyにログイン**
   - 先ほど作成した管理者アカウントでDifyにログインします。

2. **モデルプロバイダーの設定**
   - 左側のメニューから「設定」→「モデルプロバイダー」を選択します。
   - 「Google」の「セットアップ」ボタンをクリックします。
   - 先ほどコピーしたAPIキーを貼り付け、「保存」をクリックします。

3. **モデルの確認**
   - 左側のメニューから「アプリケーション」→「新規アプリケーション」を選択します。
   - アプリケーション名を入力し、「チャットアプリ」を選択して「作成」をクリックします。
   - アプリケーションが作成されたら、左側の「モデル」をクリックします。
   - モデル一覧に「Gemini」が表示されていれば、設定は完了です。

## 4. 動作確認

1. **テストチャット**
   - アプリケーションの「チャット」タブを開き、メッセージを送信してみましょう。
   - Geminiモデルからの応答が返ってくれば、正常に動作しています。

2. **エラーが表示された場合**
   - APIキーが正しく設定されているか確認してください。
   - モデルが選択されているか確認してください。
   - エラーメッセージを確認し、必要に応じて設定を見直してください。

## 5. お疲れ様でした！

これでDifyのローカル環境構築とGeminiモデルの設定が完了しました。次のワークでは、この環境を使って実際に社内FAQボットを作成していきます。

## 補足: よくある質問

### Q. 起動時にエラーが発生する
- **Dockerが起動していない**: Docker Desktopが起動しているか確認してください。
- **ポートが既に使用中**: 別のアプリケーションが80ポートを使用している場合、Docker Composeファイルのポート番号を変更してください。

### Q. モデルが表示されない
- APIキーが正しく設定されているか確認してください。
- インターネット接続を確認してください。

### Q. レスポンスが遅い
- 初回起動時はモデルのダウンロードに時間がかかることがあります。
- ハードウェアリソース（CPU、メモリ）が十分か確認してください。
